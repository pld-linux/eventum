Index: update.php
===================================================================
--- update.php	(revision 3269)
+++ update.php	(working copy)
@@ -83,6 +83,7 @@
     if (@$_POST["cat"] == "update") {
         $res = Issue::update($_POST["issue_id"]);
         $tpl->assign("update_result", $res);
+        $tpl->assign("errors", $errors);
         if (Issue::hasDuplicates($_POST["issue_id"])) {
             $tpl->assign("has_duplicates", "yes");
         }
@@ -118,7 +119,6 @@
         "resolutions"  => Resolution::getAssocList(),
         "users"        => Project::getUserAssocList($prj_id, 'active', User::getRoleID('Customer')),
         "issues"       => Issue::getColList("iss_id <> $issue_id"),
-        "assoc_issues" => array_map("htmlspecialchars", Issue::getAssocList()),
         "one_week_ts"  => time() + (7 * DAY),
         "allow_unassigned_issues"   =>  @$setup["allow_unassigned_issues"],
         "groups"       => Group::getAssocList($prj_id)
Index: js/validation.js
===================================================================
--- js/validation.js	(revision 3271)
+++ js/validation.js	(working copy)
@@ -2,9 +2,34 @@
  * @(#) $Id$
  */
 
+last_issue_number_validation_value = '';
+function validateIssueNumberField(baseURL, form_name, field_name)
+{
+    form_value = getFormElement(getForm(form_name), field_name).value;
+    if (last_issue_number_validation_value == form_value) {
+        return;
+    } else {
+        last_issue_number_validation_value = form_value;
+    }
+    validate_issue_http_client = new HTTPClient();
+    validate_issue_http_client.loadRemoteContent(baseURL + '/validate.php?action=validateIssueNumbers&values=' + 
+        form_value + '&field_name=' + field_name + '&form_name=' + form_name, 'displayIssueFieldValidation');
+}
 
+function displayIssueFieldValidation(response)
+{
+    var chunks = response.responseText.split(':',3);
+    f = getForm(chunks[0]);
+    error_span = getPageElement(chunks[1] + '_error');
+    if (chunks[2] != 'ok') {
+        selectField(f, chunks[1]);
+        error_span.innerHTML = '<b>Error</b>: The following issues are invalid: ' + chunks[2];
+    } else {
+        errorDetails(f, chunks[0], false);
+        error_span.innerHTML = '';
+    }
+}
 
-
 function isValidDate(f, field_prefix)
 {
     var selected_date = new Date();
Index: include/class.issue.php
===================================================================
--- include/class.issue.php	(revision 3269)
+++ include/class.issue.php	(working copy)
@@ -1326,6 +1326,10 @@
      */
     function update($issue_id)
     {
+
+        global $errors;
+        $errors = array();
+
         $issue_id = Misc::escapeInteger($issue_id);
 
         $usr_id = Auth::getUserID();
@@ -1333,12 +1337,24 @@
         // get all of the 'current' information of this issue
         $current = Issue::getDetails($issue_id);
         // update the issue associations
-        $association_diff = Misc::arrayDiff($current['associated_issues'], @$_POST['associated_issues']);
+        if (empty($_POST['associated_issues'])) {
+            $associated_issues = array();
+        } else {
+            $associated_issues = explode(',', @$_POST['associated_issues']);
+            // make sure all associated issues are valid (and in this project)
+            for ($i = 0; $i < count($associated_issues); $i++) {
+                if (!Issue::exists(trim($associated_issues[$i]))) {
+                    $errors['Associated Issues'][] = 'Issue #' . $associated_issues[$i] . ' does not exist and was removed from the list of associated issues.';
+                    unset($associated_issues[$i]);
+                }
+            }
+        }
+        $association_diff = Misc::arrayDiff($current['associated_issues'], $associated_issues);
         if (count($association_diff) > 0) {
             // go through the new assocations, if association already exists, skip it
             $associations_to_remove = $current['associated_issues'];
-            if (count(@$_POST['associated_issues']) > 0) {
-                foreach ($_POST['associated_issues'] as $index => $associated_id) {
+            if (count($associated_issues) > 0) {
+                foreach ($associated_issues as $index => $associated_id) {
                     if (!in_array($associated_id, $current['associated_issues'])) {
                         Issue::addAssociation($issue_id, $associated_id, $usr_id);
                     } else {
Index: validate.php
===================================================================
--- validate.php	(revision 0)
+++ validate.php	(revision 0)
@@ -0,0 +1,63 @@
+<?php
+/* vim: set expandtab tabstop=4 shiftwidth=4 encoding=utf-8: */
+// +----------------------------------------------------------------------+
+// | Eventum - Issue Tracking System                                      |
+// +----------------------------------------------------------------------+
+// | Copyright (c) 2003, 2004, 2007 MySQL AB                              |
+// |                                                                      |
+// | This program is free software; you can redistribute it and/or modify |
+// | it under the terms of the GNU General Public License as published by |
+// | the Free Software Foundation; either version 2 of the License, or    |
+// | (at your option) any later version.                                  |
+// |                                                                      |
+// | This program is distributed in the hope that it will be useful,      |
+// | but WITHOUT ANY WARRANTY; without even the implied warranty of       |
+// | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the        |
+// | GNU General Public License for more details.                         |
+// |                                                                      |
+// | You should have received a copy of the GNU General Public License    |
+// | along with this program; if not, write to:                           |
+// |                                                                      |
+// | Free Software Foundation, Inc.                                       |
+// | 59 Temple Place - Suite 330                                          |
+// | Boston, MA 02111-1307, USA.                                          |
+// +----------------------------------------------------------------------+
+// | Authors: Bryan Alsdorf <bryan@mysql.com>                             |
+// +----------------------------------------------------------------------+
+//
+// @(#) $Id$
+//
+
+require_once(dirname(__FILE__) . '/init.php');
+include_once(APP_INC_PATH . "class.auth.php");
+include_once(APP_INC_PATH . "class.issue.php");
+include_once(APP_INC_PATH . "db_access.php");
+
+Auth::checkAuthentication(APP_COOKIE);
+
+$valid_functions = array('validateIssueNumbers');
+$action = Misc::escapeString($_REQUEST['action']);
+if (in_array($action, $valid_functions)) {
+    echo $action();
+} else {
+    echo "ERROR: Unable to call function $action";
+}
+exit;
+
+function validateIssueNumbers()
+{
+    $issues = @explode(',', $_REQUEST['values']);
+    $bad_issues = array();
+    if (count($issues) > 0) {
+        for ($i = 0; $i < count($issues); $i++) {
+            if (!Issue::exists(trim($issues[$i]))) {
+                $bad_issues[] = $issues[$i];
+            }
+        }
+    }
+    if (count($bad_issues) > 0) {
+        return $_REQUEST['form_name'] . ':' . $_REQUEST['field_name'] . ':' . join(', ', $bad_issues);
+    } else {
+        return $_REQUEST['form_name'] . ':' . $_REQUEST['field_name'] . ':' . 'ok';
+    }
+}
Index: templates/update.tpl.html
===================================================================
--- templates/update.tpl.html	(revision 3269)
+++ templates/update.tpl.html	(working copy)
@@ -1,5 +1,8 @@
 {include file="header.tpl.html"}
 {include file="navigation.tpl.html"}
+<script language="javascript">
+{include file="js/httpclient.js"}
+</script>
 
 {if $issue == ""}
   <table width="300" align="center">
Index: templates/update_form.tpl.html
===================================================================
--- templates/update_form.tpl.html	(revision 3269)
+++ templates/update_form.tpl.html	(working copy)
@@ -14,7 +14,22 @@
               {if $has_duplicates == 'yes'}
                 <br />{t}Also, all issues that are marked as duplicates from this one were updated as well.{/t}
               {/if}
-              <br /><br />
+
+              {if $errors|@count > 0}
+              <br /><br />However, there are some warnings you should be aware of:<br />
+              <ul>
+              {foreach from=$errors key=section item=sub_errors}
+                <li>{$section}<br />
+                  {foreach from=$sub_errors item=msg}
+                    &nbsp;&nbsp;&nbsp;&nbsp;{$msg}<br />
+                  {/foreach}
+                </li>
+              {/foreach}
+              </ul>
+              {else}
+                <br /><br />
+              {/if}
+
               <b>
                 <a href="update.php?id={$smarty.post.issue_id}" class="link">{t 1=$smarty.post.issue_id}Update Issue #%1{/t}</a><br />
                 <a href="view.php?id={$smarty.post.issue_id}" class="link">{t 1=$smarty.post.issue_id}Return to Issue #%1 Details Page{/t}</a>
@@ -190,11 +205,9 @@
             <nobr><b>{t}Associated Issues:{/t}</b></nobr>
           </td>
           <td bgcolor="{$light_color}">
-            <select size="4" multiple name="associated_issues[]" class="default" onChange="showSelections('update_form', 'associated_issues[]')">
-              {html_options values=$issues output=$issues selected=$issue.associated_issues}
-            </select>
-            {if not ($os.mac and $browser.ie)}<a title="lookup issues by their summaries" href="javascript:void(null);" onClick="return overlib(getOverlibContents('{include file="lookup_layer.tpl.html" list=$assoc_issues multiple=1}', 'update_form', 'associated_issues[]', true), STICKY, HEIGHT, 50, WIDTH, 250, BELOW, RIGHT, CLOSECOLOR, '#FFFFFF', FGCOLOR, '#FFFFFF', BGCOLOR, '#000000', CAPTION, 'Lookup Details', CLOSECLICK);" onMouseOut="javascript:nd();"><img src="{$rel_url}images/lookup.gif" border="0"></a>{/if}
-            <div class="default" id="selection_associated_issues[]"></div>
+            <input type="text" name="associated_issues" value="{", "|join:$issue.associated_issues}" class="default" onBlur="validateIssueNumberField('{$rel_url}', 'update_form', 'associated_issues')">
+            {include file="error_icon.tpl.html" field="associated_issues"}
+            <span id="associated_issues_error" class="default"></span>
           </td>
           {/if}
           <td nowrap width="130" bgcolor="{$cell_color}" class="default_white">
